<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dragalia Target Summoning Success Chance Calculator</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-156923332-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-156923332-1');
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        rateNormal = 0.04751
        rateGala = 0.06544
        rateAdventurer = 0.005
        rateDragon = 0.008
        targetMax = 6

        function setRolls(rolls) {
            let value = parseInt(rolls, 10)
            document.getElementById("single").value = 0
            document.getElementById("tenfold").value = 0
            document.getElementById("wyrmmite").value = value * 120
            calculate()
        }

        function setGala(boolean){
            document.getElementById("gala").checked = boolean
            calculate()
        }

        function setQuickGala(){
            setGala(true)
            setAdventurerRate("target1")
            for (let i=2; i<=targetMax; i++){
                setClearRate("target" + i)
            }
        }

        function setRate(id, value){
            let v = value * 100
            if (v == 0) v = null
            document.getElementById(id).value = v
            calculate()
        }

        function setClearRate(id){
            setRate(id, null)
        }
        
        function setAdventurerRate(id){
            setRate(id, rateAdventurer)
        }

        function setDragonRate(id){
            setRate(id, rateDragon)
        }

        function clearAll() {
            setRolls(300)
            setGala(false)
            for (let i=1; i<=targetMax; i++){
                setClearRate("target" + i)
            }
        }

        function calculate(){

            const isGala = document.getElementById("gala").checked
            const rate = isGala ? rateGala : rateNormal

            const single = parseInt(document.getElementById("single").value, 10)
            const tenfold = parseInt(document.getElementById("tenfold").value, 10)
            const wyrmmite = parseInt(document.getElementById("wyrmmite").value, 10)
            const rolls = single + tenfold*10.0 + wyrmmite/120.0
            document.getElementById("rolls").value = rolls

            const fiveStarCount = rolls * rate

            let target = []
            for (let i=1; i<=targetMax; i++){
                let id = "target" + i
                let field = document.getElementById(id)
                if (field != null && field.value > 0) {
                    let v = field.value / 100.0
                    target.push(v)
                }
            }

            let successRate = 1.000
            for (let i=0; i<target.length; i++){
                let rateLocal = target[i]*1.00 / rate
                let rateFail = Math.pow(1.00-rateLocal, fiveStarCount)
                let rateSuccess = 1.00 - rateFail
                successRate = successRate * rateSuccess
            }

            let successRatePercent = successRate * 100
            document.getElementById("successRate").innerText = successRatePercent.toFixed(3) + "%"
        }

        $(document).ready(function (){
            let inputs = document.querySelectorAll('input')
            inputs.forEach(element => {
                element.addEventListener('input', updateValue)
                function updateValue(e){
                    calculate()
                }
            })

            calculate()
        });
    </script>
</head>
<body>
    <h1>Dragalia Target Summoning Success Chance Calculator</h1>

    <table>
        <tr>
            <td>Single/Ten:</td>
            <td><input type="number" id="single" value="100"></td>
            <td colspan="3"><input type="number" id="tenfold" value="10"></td>
        </tr>
        <tr>
            <td>Wyrmmite:</td>
            <td><input type="number" id="wyrmmite" value="12000" step="120"></td>
        </tr>
        <tr>
            <td>Rolls:</td>
            <td><input type="number" id="rolls" value="300" disabled></td>
            <td colspan="3">
                <button onclick="setRolls(100)">100</button>
                <button onclick="setRolls(200)">200</button>
                <button onclick="setRolls(300)">300</button>
            </td>
        </tr>
        <tr>
            <td>Gala:</td>
            <td><input type="checkbox" id="gala"></td>
            <td colspan="3">
                <button onclick="setQuickGala()">Quick set Gala</button></td>
            </td>
        </tr>
        <tr>
            <td>Target 1 (%):</td>
            <td><input type="number" id="target1" step="0.1" value="0.5"></td>
            <td><button onclick="setClearRate('target1')">Clear</button></td>
            <td><button onclick="setAdventurerRate('target1')">Adventurer</button></td>
            <td><button onclick="setDragonRate('target1')">Dragon</button></td>
        </tr>
        <tr>
            <td>Target 2 (%):</td>
            <td><input type="number" id="target2" step="0.1" value="0.5"></td>
            <td><button onclick="setClearRate('target2')">Clear</button></td>
            <td><button onclick="setAdventurerRate('target2')">Adventurer</button></td>
            <td><button onclick="setDragonRate('target2')">Dragon</button></td>
        </tr>
        <tr>
            <td>Target 3 (%):</td>
            <td><input type="number" id="target3" step="0.1" value="0.8"></td>
            <td><button onclick="setClearRate('target3')">Clear</button></td>
            <td><button onclick="setAdventurerRate('target3')">Adventurer</button></td>
            <td><button onclick="setDragonRate('target3')">Dragon</button></td>
        </tr>
        <tr>
            <td>Target 4 (%):</td>
            <td><input type="number" id="target4" step="0.1"></td>
            <td><button onclick="setClearRate('target4')">Clear</button></td>
            <td><button onclick="setAdventurerRate('target4')">Adventurer</button></td>
            <td><button onclick="setDragonRate('target4')">Dragon</button></td>
        </tr>
        <tr>
            <td>Target 5 (%):</td>
            <td><input type="number" id="target5" step="0.1"></td>
            <td><button onclick="setClearRate('target5')">Clear</button></td>
            <td><button onclick="setAdventurerRate('target5')">Adventurer</button></td>
            <td><button onclick="setDragonRate('target5')">Dragon</button></td>
        </tr>
        <tr>
            <td>Target 6 (%):</td>
            <td><input type="number" id="target6" step="0.1"></td>
            <td><button onclick="setClearRate('target6')">Clear</button></td>
            <td><button onclick="setAdventurerRate('target6')">Adventurer</button></td>
            <td><button onclick="setDragonRate('target6')">Dragon</button></td>
        </tr>
        <tr>
            <td colspan="2"></td>
            <td colspan="3">
                <button onclick="clearAll()">Clear All</button>
            </td>
        </tr>
        <tr>
            <td>Success Rate:</td>
            <td><p id="successRate" style="font-weight: bold; margin: 0">00.000%</p></td>
            <td colspan="3"><button onclick="calculate()">Calculate</button><br></td>
        </tr>
        <tr>
            <td>Author:</td>
            <td colspan="5">reddit u/sinoa000</td>
        </tr>
        <tr>
            <td>Last Update:</td>
            <td colspan="5">20:00 24-01-2020</td>
        </tr>
    </table>
</body>
</html>
